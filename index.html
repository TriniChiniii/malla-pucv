<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Interactiva Ingeniería Civil Electrónica PUCV</title>
  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #1e1e1e;
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #menu {
      background-color: #252526;
      padding: 10px;
      display: flex;
      gap: 10px;
      border-bottom: 1px solid #333;
    }

    #menu button {
      background: #007acc;
      border: none;
      color: white;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 4px;
    }

    #cy {
      flex-grow: 1;
    }

    .approved {
      background-color: #4caf50 !important;
    }
  </style>
</head>
<body>
  <div id="menu">
    <button id="togglePrereq">Ocultar Prerrequisitos</button>
    <button id="toggleApproved">Ocultar Aprobados</button>
    <button id="resetApproved">Resetear Aprobados</button>
  </div>
  <div id="cy"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const colorMap = {
        1: '#FFB6C1', 2: '#ADD8E6', 3: '#90EE90', 4: '#FFFF99', 5: '#FFA07A',
        6: '#9370DB', 7: '#F0E68C', 8: '#40E0D0', 9: '#FFDEAD', 10: '#D3D3D3', 11: '#F5DEB3'
      };

      const storageKey = 'malla-pucv-approved';
      let approved = JSON.parse(localStorage.getItem(storageKey)) || [];
      let hidePrereqs = false;
      let hideApproved = false;

      const horizontalSpacing = 250;
      const verticalSpacing = 160;

      const data = [
        'MAT1001','EIE142','FIS1121','FIN100-11','QUI1140','MAT1002','MAT1004','FIS1001','EIE100','MAT1003','MAT1005','FIS1141','EIE211','EIE200','EIE267','EIE274','EIE275','EIE280','EIE310','EIE326','EIE348','EIE375','ING9001','EIE315','EIE316','EIE374','EIE439','ING9002','EIE341','EIE376','EIE430','EIE434','ING9003','EIE317','EIE420','EIE437','EIE438','EIE453','ING9004','EIE303','EIE400','EII509','DER1170','EIE620','EIE626'
      ];

      const positions = {};
      data.forEach((id, idx) => {
        const semester = Math.floor(idx / 4) + 1;
        positions[id] = { x: semester * horizontalSpacing, y: (idx % 4) * verticalSpacing + 100 };
      });

      const courses = {
        'MAT1001': [], 'EIE142': [], 'FIS1121': [], 'FIN100-11': [], 'QUI1140': [],
        'MAT1002': ['MAT1001'], 'MAT1004': ['MAT1001'], 'FIS1001': ['MAT1001'],
        'EIE100': [], 'MAT1003': ['MAT1002'], 'MAT1005': ['MAT1004'], 'FIS1141': ['FIS1001'], 'EIE211': ['MAT1002'],
        'EIE200': ['EIE100'], 'EIE267': ['MAT1003'], 'EIE274': ['MAT1005'], 'EIE275': ['MAT1003'], 'EIE280': ['MAT1005'],
        'EIE310': ['EIE275'], 'EIE326': ['EIE274','EIE280'], 'EIE348': ['MAT1004'], 'EIE375': ['EIE275'], 'ING9001': [],
        'EIE315': ['EIE275'], 'EIE316': ['EIE267'], 'EIE374': ['EIE280'], 'EIE439': ['EIE348'], 'ING9002': ['ING9001'],
        'EIE341': ['EIE315'], 'EIE376': ['EIE374'], 'EIE430': ['EIE374'], 'EIE434': ['EIE439'], 'ING9003': ['ING9002'],
        'EIE317': ['EIE315'], 'EIE420': ['EIE310'], 'EIE437': ['EIE376'], 'EIE438': ['EIE430'],
        'EIE453': ['EIE275','EIE274','EIE267','EIE280','EIE200'], 'ING9004': ['ING9003'],
        'EIE303': ['EIE439'], 'EIE400': ['EIE275','EIE274','EIE267','EIE280','EIE200'],
        'EII509': ['EIE315','EIE439','EIE374','EIE316','ING9002'],
        'DER1170': ['EIE315','EIE439','EIE374','EIE316','ING9002'],
        'EIE620': ['EIE317','EIE420','EIE437','EIE438','ING9004','EIE453'],
        'EIE626': ['EIE620']
      };

      const elements = [];

      Object.keys(courses).forEach(id => {
        elements.push({
          data: { id: id, label: id },
          position: positions[id],
          classes: approved.includes(id) ? 'approved' : '',
          style: { 'background-color': colorMap[Math.ceil(Object.keys(positions).indexOf(id)/4)+1] }
        });
        courses[id].forEach(pr => {
          elements.push({ data: { source: pr, target: id } });
        });
      });

      const cy = cytoscape({
        container: document.getElementById('cy'),
        elements: elements,
        style: [
          {
            selector: 'node',
            style: {
              'label': 'data(label)',
              'text-valign': 'center',
              'text-halign': 'center',
              'background-color': 'data(background-color)',
              'color': '#000',
              'shape': 'roundrectangle',
              'width': 'label',
              'padding': '8px'
            }
          },
          {
            selector: 'node.approved',
            style: {
              'background-color': '#4caf50',
              'color': '#fff'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 2,
              'line-color': '#888',
              'target-arrow-color': '#888',
              'target-arrow-shape': 'triangle'
            }
          }
        ],
        layout: { name: 'preset' }
      });

      cy.nodes().on('click', evt => {
        const node = evt.target;
        node.toggleClass('approved');
        approved = cy.nodes('.approved').map(n => n.id());
        localStorage.setItem(storageKey, JSON.stringify(approved));
      });

      document.getElementById('togglePrereq').addEventListener('click', () => {
        hidePrereqs = !hidePrereqs;
        cy.edges().forEach(edge => edge.style('display', hidePrereqs ? 'none' : 'element'));
      });

      document.getElementById('toggleApproved').addEventListener('click', () => {
        hideApproved = !hideApproved;
        cy.nodes('.approved').forEach(node => node.style('display', hideApproved ? 'none' : 'element'));
      });

      document.getElementById('resetApproved').addEventListener('click', () => {
        cy.nodes('.approved').forEach(node => node.removeClass('approved'));
        localStorage.removeItem(storageKey);
        approved = [];
      });
    });
  </script>
</body>
</html>
